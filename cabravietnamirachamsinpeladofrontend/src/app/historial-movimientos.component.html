<div class="container-fluid px-4">
  <h1 class="mt-3">Historial de Movimientos</h1>
  <ol class="breadcrumb mb-4">
    <li class="breadcrumb-item"><a routerLink="/dashboard">Dashboard</a></li>
    <li class="breadcrumb-item active">Movimientos</li>
  </ol>
  <div class="row mb-3">
    <div class="col-md-3 mb-2">
      <label>Producto:</label>
      <select class="form-select" [(ngModel)]="filtroProducto" (change)="cargarMovimientos()">
        <option value="">Todos</option>
        <option *ngFor="let p of productos" [value]="p.id">{{ p.nombre }}</option>
      </select>
    </div>
    <div class="col-md-2 mb-2">
      <label>Tipo:</label>
      <select class="form-select" [(ngModel)]="filtroTipo" (change)="cargarMovimientos()">
        <option value="">Todos</option>
        <option value="entrada">Entrada</option>
        <option value="salida">Salida</option>
        <option value="ajuste">Ajuste</option>
      </select>
    </div>
    <div class="col-md-3 mb-2">
      <label>Usuario:</label>
      <input class="form-control" [(ngModel)]="filtroUsuario" (input)="cargarMovimientos()" placeholder="Usuario...">
    </div>
    <div class="col-md-2 mb-2">
      <label>Fecha:</label>
      <input type="date" class="form-control" [(ngModel)]="filtroFecha" (change)="cargarMovimientos()">
    </div>
    <div class="col-md-2 mb-2 d-flex align-items-end">
      <button class="btn btn-secondary w-100" (click)="cargarMovimientos()"><i class="fas fa-sync"></i> Actualizar</button>
    </div>
  </div>
  <div class="card mb-4">
    <div class="card-header bg-primary text-white">
      <strong>Movimientos</strong>
    </div>
    <div class="card-body p-0">
      <div *ngIf="movimientos.length === 0" class="p-3 text-muted">No hay movimientos para los filtros seleccionados.</div>
      <div *ngIf="movimientos.length > 0">
        <div class="table-responsive">
          <table class="table table-striped table-bordered mb-0">
            <thead class="table-light">
              <tr>
                <th>Fecha</th>
                <th>Producto</th>
                <th>Tipo</th>
                <th>Cantidad</th>
                <th>Usuario</th>
                <th>Motivo/Descripci√≥n</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let m of movimientos">
                <td>{{ m.fecha | date:'short' }}</td>
                <td>{{ getNombreProducto(m.producto) }}</td>
                <td><span class="badge bg-{{ m.tipo === 'entrada' ? 'success' : (m.tipo === 'salida' ? 'danger' : 'warning') }}">{{ m.tipo | titlecase }}</span></td>
                <td>{{ m.cantidad }}</td>
                <td>{{ getUsuarioMovimiento(m.usuario) }}</td>
                <td>{{ m.descripcion }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
