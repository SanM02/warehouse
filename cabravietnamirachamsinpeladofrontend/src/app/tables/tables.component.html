<!-- ==========================================  -->
<!-- üè≠ INVENTARIO INDUSTRIAL - Ferreter√≠a J&G -->
<!-- ==========================================  -->

<div class="inventario-industrial-wrapper">
  
  <!-- Header Industrial -->
  <div class="header-industrial">
    <div class="header-content">
      <div class="title-group">
        <i class="fas fa-warehouse header-icon"></i>
        <h1 class="page-title">INVENTARIO DE PRODUCTOS</h1>
      </div>
      <div class="title-underline"></div>
    </div>
    
    <!-- Breadcrumbs Industrial -->
    <nav class="breadcrumb-industrial">
      <a routerLink="/" class="breadcrumb-item-industrial">
        <i class="fas fa-home"></i>
        <span>INICIO</span>
      </a>
      <span class="breadcrumb-separator">/</span>
      <span class="breadcrumb-item-industrial active">
        <i class="fas fa-boxes"></i>
        <span>INVENTARIO</span>
      </span>
    </nav>
  </div>

  <!-- Contenedor Principal -->
  <div class="main-card-industrial">
    
    <!-- Card Header -->
    <div class="card-header-industrial">
      <div class="header-left">
        <i class="fas fa-table"></i>
        <span>LISTADO DE ART√çCULOS</span>
      </div>
      <div class="header-decoration"></div>
    </div>

    <!-- Card Body -->
    <div class="card-body-industrial">
      
      <!-- Controles de B√∫squeda -->
      <div class="search-controls-industrial">
        
        <!-- Buscador -->
        <div class="control-group">
          <label class="control-label-industrial">
            <i class="fas fa-search"></i>
            BUSCAR PRODUCTO
          </label>
          <div class="input-wrapper-industrial">
            <input 
              type="text" 
              class="input-industrial" 
              placeholder="Nombre o categor√≠a..." 
              [(ngModel)]="search">
            <div class="input-border-effect"></div>
          </div>
        </div>

        <!-- Filtro Categor√≠a -->
        <div class="control-group">
          <label class="control-label-industrial">
            <i class="fas fa-filter"></i>
            FILTRAR CATEGOR√çA
          </label>
          <div class="select-wrapper-industrial">
            <select class="select-industrial" [(ngModel)]="filtroCategoria">
              <option value="">Todas las categor√≠as</option>
              <option *ngFor="let cat of categorias" [value]="cat">{{ cat }}</option>
            </select>
            <i class="fas fa-chevron-down select-icon"></i>
          </div>
        </div>

        <!-- Contador Total -->
        <div class="control-group">
          <label class="control-label-industrial">
            <i class="fas fa-calculator"></i>
            TOTAL PRODUCTOS
          </label>
          <div class="counter-badge-industrial">
            <span class="counter-number">{{ productosFiltrados.length }}</span>
            <span class="counter-label">ITEMS</span>
          </div>
        </div>

      </div>

      <!-- Tabla Industrial -->
      <div class="table-wrapper-industrial">
        <table class="table-industrial">
          <thead class="thead-industrial">
            <tr>
              <th><i class="fas fa-barcode"></i> C√ìDIGO</th>
              <th><i class="fas fa-tag"></i> PRODUCTO</th>
              <th><i class="fas fa-folder"></i> CATEGOR√çA</th>
              <th><i class="fas fa-copyright"></i> MARCA</th>
              <th><i class="fas fa-car"></i> MODELO</th>
              <th><i class="fas fa-align-left"></i> DESCRIPCI√ìN</th>
              <th><i class="fas fa-boxes"></i> STOCK</th>
              <th><i class="fas fa-exclamation-triangle"></i> M√çN</th>
              <th><i class="fas fa-dollar-sign"></i> COSTO</th>
              <th><i class="fas fa-money-bill-wave"></i> VENTA</th>
              <th><i class="fas fa-truck"></i> PROVEEDOR</th>
              <th><i class="fas fa-calendar"></i> INGRESO</th>
              <th><i class="fas fa-map-marker-alt"></i> UBICACI√ìN</th>
              <th><i class="fas fa-cogs"></i> ACCIONES</th>
            </tr>
          </thead>
          <tbody class="tbody-industrial">
            <tr *ngFor="let producto of productosPagina; trackBy: trackByProductoId; let i = index" 
                class="row-industrial"
                [style.animation-delay]="(i * 0.05) + 's'">
              
              <td><code class="code-badge">{{ producto.codigo }}</code></td>
              
              <td class="cell-highlight">{{ producto.nombre }}</td>
              
              <td>
                <span class="badge-industrial" [ngStyle]="getCategoriaBadgeStyle(producto.categoria)">
                  {{ producto.categoria }}
                </span>
              </td>
              
              <td>{{ producto.marca }}</td>
              <td>{{ producto.modeloCompatible }}</td>
              <td class="cell-description">{{ producto.descripcion }}</td>
              
              <td>
                <ng-container *ngIf="editandoStock[producto.id] !== undefined; else vistaNormal">
                  <input 
                    type="number" 
                    class="input-stock-edit" 
                    [(ngModel)]="editandoStock[producto.id]" 
                    min="0">
                </ng-container>
                <ng-template #vistaNormal>
                  <span class="stock-badge">{{ producto.cantidad }}</span>
                </ng-template>
              </td>
              
              <td>
                <span class="stock-min-badge">{{ producto.stockMinimo }}</span>
              </td>
              
              <td>
                <span class="price-badge price-costo">‚Ç≤{{ producto.precioCosto | number:'1.0-0' }}</span>
              </td>
              
              <td>
                <span class="price-badge price-venta">‚Ç≤{{ producto.precioVenta | number:'1.0-0' }}</span>
              </td>
              
              <td>{{ producto.proveedor }}</td>
              <td>{{ producto.fechaIngreso }}</td>
              
              <td>
                <span class="ubicacion-badge">
                  <i class="fas fa-map-pin"></i>
                  {{ producto.ubicacion }}
                </span>
              </td>
              
              <td>
                <ng-container *ngIf="editandoStock[producto.id] !== undefined; else botonesEdicion">
                  <button 
                    class="btn-industrial btn-save" 
                    (click)="guardarStock(producto)" 
                    [disabled]="guardando[producto.id]">
                    <i class="fas fa-save"></i>
                  </button>
                  <button 
                    class="btn-industrial btn-cancel" 
                    (click)="cancelarEdicion(producto)" 
                    [disabled]="guardando[producto.id]">
                    <i class="fas fa-times"></i>
                  </button>
                </ng-container>
                
                <ng-template #botonesEdicion>
                  <div class="action-buttons-industrial">
                    <button 
                      class="btn-industrial btn-edit" 
                      (click)="abrirModalEditar(producto)" 
                      title="Editar">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button 
                      class="btn-industrial btn-delete" 
                      (click)="eliminarProducto(producto)" 
                      title="Eliminar">
                      <i class="fas fa-trash"></i>
                    </button>
                    <button 
                      class="btn-industrial btn-add" 
                      (click)="iniciarEdicion(producto); sumar(producto)" 
                      title="Agregar">
                      <i class="fas fa-plus"></i>
                    </button>
                    <button 
                      class="btn-industrial btn-minus" 
                      (click)="iniciarEdicion(producto); restar(producto)" 
                      [disabled]="producto.cantidad === 0" 
                      title="Quitar">
                      <i class="fas fa-minus"></i>
                    </button>
                  </div>
                </ng-template>
              </td>
              
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Paginaci√≥n Industrial -->
      <nav *ngIf="totalPaginas > 1" class="pagination-industrial">
        <button 
          class="pagination-btn" 
          [class.disabled]="page === 1" 
          (click)="setPagina(page-1)" 
          [disabled]="page === 1">
          <i class="fas fa-chevron-left"></i>
          <span>ANTERIOR</span>
        </button>
        
        <div class="pagination-numbers">
          <button 
            *ngFor="let p of [].constructor(totalPaginas); let i = index" 
            class="pagination-number"
            [class.active]="page === (i+1)"
            (click)="setPagina(i+1)">
            {{ i+1 }}
          </button>
        </div>
        
        <button 
          class="pagination-btn" 
          [class.disabled]="page === totalPaginas" 
          (click)="setPagina(page+1)" 
          [disabled]="page === totalPaginas">
          <span>SIGUIENTE</span>
          <i class="fas fa-chevron-right"></i>
        </button>
      </nav>

    </div>
  </div>

</div>

<!-- ============================================ -->
<!-- MODAL DE EDICI√ìN INDUSTRIAL -->
<!-- ============================================ -->
<div *ngIf="mostrarModalEdicion" class="modal-backdrop-industrial"></div>
<div *ngIf="mostrarModalEdicion" class="modal-industrial">
  <div class="modal-container-industrial">
    
    <!-- Modal Header -->
    <div class="modal-header-industrial">
      <div class="modal-title-group">
        <i class="fas fa-edit"></i>
        <h3>EDITAR PRODUCTO</h3>
      </div>
      <button class="btn-close-industrial" (click)="cerrarModalEdicion()">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <!-- Modal Body -->
    <div class="modal-body-industrial">
      <form *ngIf="productoEditando" class="form-industrial">
        
        <div class="form-row-industrial">
          <div class="form-group-modal small">
            <label class="modal-label-industrial">
              <i class="fas fa-barcode"></i>
              C√ìDIGO
            </label>
            <input type="text" class="modal-input-industrial" [(ngModel)]="productoEditando.codigo" name="codigo">
          </div>
          
          <div class="form-group-modal large">
            <label class="modal-label-industrial">
              <i class="fas fa-tag"></i>
              NOMBRE <span class="required">*</span>
            </label>
            <input type="text" class="modal-input-industrial" [(ngModel)]="productoEditando.nombre" name="nombre" required>
          </div>
          
          <div class="form-group-modal medium">
            <label class="modal-label-industrial">
              <i class="fas fa-folder"></i>
              CATEGOR√çA
            </label>
            <input type="text" class="modal-input-industrial" [(ngModel)]="productoEditando.categoria" name="categoria">
          </div>
        </div>

        <div class="form-row-industrial">
          <div class="form-group-modal small">
            <label class="modal-label-industrial">
              <i class="fas fa-copyright"></i>
              MARCA
            </label>
            <input type="text" class="modal-input-industrial" [(ngModel)]="productoEditando.marca" name="marca">
          </div>
          
          <div class="form-group-modal medium">
            <label class="modal-label-industrial">
              <i class="fas fa-car"></i>
              MODELO COMPATIBLE
            </label>
            <input type="text" class="modal-input-industrial" [(ngModel)]="productoEditando.modeloCompatible" name="modeloCompatible">
          </div>
          
          <div class="form-group-modal large">
            <label class="modal-label-industrial">
              <i class="fas fa-map-marker-alt"></i>
              UBICACI√ìN F√çSICA
            </label>
            <input type="text" class="modal-input-industrial" [(ngModel)]="productoEditando.ubicacion" name="ubicacion" placeholder="Ej: Estante A3">
          </div>
        </div>

        <div class="form-row-industrial">
          <div class="form-group-modal full">
            <label class="modal-label-industrial">
              <i class="fas fa-align-left"></i>
              DESCRIPCI√ìN
            </label>
            <textarea class="modal-textarea-industrial" [(ngModel)]="productoEditando.descripcion" name="descripcion" rows="3"></textarea>
          </div>
        </div>

        <div class="form-row-industrial">
          <div class="form-group-modal xsmall">
            <label class="modal-label-industrial">
              <i class="fas fa-boxes"></i>
              STOCK ACTUAL
            </label>
            <input type="number" class="modal-input-industrial" [(ngModel)]="productoEditando.cantidad" name="cantidad" min="0">
          </div>
          
          <div class="form-group-modal xsmall">
            <label class="modal-label-industrial">
              <i class="fas fa-exclamation-triangle"></i>
              STOCK M√çNIMO
            </label>
            <input type="number" class="modal-input-industrial" [(ngModel)]="productoEditando.stockMinimo" name="stockMinimo" min="0">
          </div>
          
          <div class="form-group-modal medium">
            <label class="modal-label-industrial">
              <i class="fas fa-dollar-sign"></i>
              PRECIO COSTO (‚Ç≤)
            </label>
            <input type="number" class="modal-input-industrial" [(ngModel)]="productoEditando.precioCosto" name="precioCosto" min="0" (ngModelChange)="calcularPrecioVentaEdicion()">
          </div>
          
          <div class="form-group-modal medium">
            <label class="modal-label-industrial">
              <i class="fas fa-money-bill-wave"></i>
              PRECIO VENTA (‚Ç≤) <small>(+30%)</small>
            </label>
            <input type="number" class="modal-input-industrial readonly-input" [(ngModel)]="productoEditando.precioVenta" name="precioVenta" min="0" readonly>
          </div>
          
          <div class="form-group-modal small">
            <label class="modal-label-industrial">
              <i class="fas fa-truck"></i>
              PROVEEDOR
            </label>
            <input type="text" class="modal-input-industrial" [(ngModel)]="productoEditando.proveedor" name="proveedor">
          </div>
        </div>

      </form>
    </div>

    <!-- Modal Footer -->
    <div class="modal-footer-industrial">
      <button 
        class="btn-modal-industrial btn-modal-cancel" 
        (click)="cerrarModalEdicion()" 
        [disabled]="guardandoEdicion">
        <i class="fas fa-times"></i>
        <span>CANCELAR</span>
      </button>
      <button 
        class="btn-modal-industrial btn-modal-save" 
        (click)="guardarEdicionCompleta()" 
        [disabled]="guardandoEdicion">
        <span *ngIf="!guardandoEdicion">
          <i class="fas fa-save"></i>
          <span>GUARDAR CAMBIOS</span>
        </span>
        <span *ngIf="guardandoEdicion">
          <i class="fas fa-spinner fa-spin"></i>
          <span>GUARDANDO...</span>
        </span>
      </button>
    </div>
    
  </div>
</div>
<div class="card mb-4">
  <div class="card-header">
    <i class="fas fa-table me-1"></i>
    Listado de Articulos
  </div>
  <div class="card-body">
    <div class="row mb-3">
      <div class="col-md-4 mb-2">
        <input type="text" class="form-control" placeholder="Buscar por nombre o categor√≠a..." [(ngModel)]="search">
      </div>
      <div class="col-md-4 mb-2">
        <select class="form-select" [(ngModel)]="filtroCategoria">
          <option value="">Todas las categor√≠as</option>
          <option *ngFor="let cat of categorias" [value]="cat">{{ cat }}</option>
        </select>
      </div>
      <div class="col-md-4 mb-2 text-end">
        <span class="badge bg-primary">Total: {{ productosFiltrados.length }}</span>
      </div>
    </div>
    <table class="table table-hover table-bordered align-middle shadow-sm rounded">
      <thead class="table-primary text-center align-middle">
        <tr>
          <th>C√≥digo</th>
          <th>Nombre del repuesto</th>
          <th>Categor√≠a</th>
          <th>Marca</th>
          <th>Modelo compatible</th>
          <th>Descripci√≥n</th>
          <th>Stock actual</th>
          <th>Stock m√≠nimo</th>
          <th>Precio de costo</th>
          <th>Precio de venta</th>
          <th>Proveedor</th>
          <th>Fecha de ingreso</th>
          <th>Ubicaci√≥n f√≠sica</th>
          <th><i class="fas fa-cogs"></i> Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let producto of productosPagina; trackBy: trackByProductoId" class="text-center">
          <td>{{ producto.codigo }}</td>
          <td class="fw-semibold">{{ producto.nombre }}</td>
          <td>
            <span class="badge-industrial" [ngStyle]="getCategoriaBadgeStyle(producto.categoria)">
              {{ producto.categoria }}
            </span>
          </td>
          <td>{{ producto.marca }}</td>
          <td>{{ producto.modeloCompatible }}</td>
          <td>{{ producto.descripcion }}</td>
          <td>
            <ng-container *ngIf="editandoStock[producto.id] !== undefined; else vistaNormal">
              <input type="number" class="form-control form-control-sm d-inline-block w-auto text-center" [(ngModel)]="editandoStock[producto.id]" min="0" style="width:70px;" />
            </ng-container>
            <ng-template #vistaNormal>
              <span class="badge bg-light text-dark fs-6 px-3">{{ producto.cantidad }}</span>
            </ng-template>
          </td>
          <td>{{ producto.stockMinimo }}</td>
          <td><span class="fw-bold text-success">‚Ç≤{{ producto.precioCosto | number:'1.0-0' }}</span></td>
          <td><span class="fw-bold text-success">‚Ç≤{{ producto.precioVenta | number:'1.0-0' }}</span></td>
          <td>{{ producto.proveedor }}</td>
          <td>{{ producto.fechaIngreso }}</td>
          <td><span class="badge bg-secondary">{{ producto.ubicacion }}</span></td>
          <td>
            <ng-container *ngIf="editandoStock[producto.id] !== undefined; else botonesEdicion">
              <button class="btn btn-success btn-sm me-1" (click)="guardarStock(producto)" [disabled]="guardando[producto.id]">
                <i class="fas fa-save"></i>
              </button>
              <button class="btn btn-secondary btn-sm" (click)="cancelarEdicion(producto)" [disabled]="guardando[producto.id]">
                <i class="fas fa-times"></i>
              </button>
            </ng-container>
            <ng-template #botonesEdicion>
              <div class="btn-group btn-group-sm" role="group">
                <button class="btn btn-warning" (click)="abrirModalEditar(producto)" title="Editar producto">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-danger" (click)="eliminarProducto(producto)" title="Eliminar producto">
                  <i class="fas fa-trash"></i>
                </button>
                <button class="btn btn-outline-success" (click)="iniciarEdicion(producto); sumar(producto)" title="Agregar">
                  <i class="fas fa-plus"></i>
                </button>
                <button class="btn btn-outline-danger" (click)="iniciarEdicion(producto); restar(producto)" [disabled]="producto.cantidad === 0" title="Quitar">
                  <i class="fas fa-minus"></i>
                </button>
              </div>
            </ng-template>
          </td>
        </tr>
      </tbody>
    </table>
    <nav *ngIf="totalPaginas > 1">
      <ul class="pagination justify-content-center">
        <li class="page-item" [class.disabled]="page === 1">
          <button class="page-link" (click)="setPagina(page-1)" [disabled]="page === 1">&laquo;</button>
        </li>
        <li class="page-item" *ngFor="let p of [].constructor(totalPaginas); let i = index" [class.active]="page === (i+1)">
          <button class="page-link" (click)="setPagina(i+1)">{{ i+1 }}</button>
        </li>
        <li class="page-item" [class.disabled]="page === totalPaginas">
          <button class="page-link" (click)="setPagina(page+1)" [disabled]="page === totalPaginas">&raquo;</button>
        </li>
      </ul>
    </nav>
  </div>
</div>

<!-- ============================================ -->
<!-- MODAL DE EDICI√ìN DE PRODUCTO -->
<!-- ============================================ -->
<div *ngIf="mostrarModalEdicion" class="modal-backdrop fade show"></div>
<div *ngIf="mostrarModalEdicion" class="modal fade show d-block" tabindex="-1">
  <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content">
      
      <!-- ENCABEZADO -->
      <div class="modal-header bg-warning text-dark">
        <h5 class="modal-title">
          <i class="fas fa-edit me-2"></i>Editar Producto
        </h5>
        <button type="button" class="btn-close" (click)="cerrarModalEdicion()"></button>
      </div>

      <!-- CUERPO -->
      <div class="modal-body">
        <form *ngIf="productoEditando">
          <div class="row g-3">
            <div class="col-md-3">
              <label class="form-label">C√≥digo</label>
              <input type="text" class="form-control" [(ngModel)]="productoEditando.codigo" name="codigo">
            </div>
            <div class="col-md-5">
              <label class="form-label">Nombre <span class="text-danger">*</span></label>
              <input type="text" class="form-control" [(ngModel)]="productoEditando.nombre" name="nombre" required>
            </div>
            <div class="col-md-4">
              <label class="form-label">Categor√≠a</label>
              <input type="text" class="form-control" [(ngModel)]="productoEditando.categoria" name="categoria">
            </div>
            <div class="col-md-3">
              <label class="form-label">Marca</label>
              <input type="text" class="form-control" [(ngModel)]="productoEditando.marca" name="marca">
            </div>
            <div class="col-md-4">
              <label class="form-label">Modelo Compatible</label>
              <input type="text" class="form-control" [(ngModel)]="productoEditando.modeloCompatible" name="modeloCompatible">
            </div>
            <div class="col-md-5">
              <label class="form-label">Ubicaci√≥n F√≠sica</label>
              <input type="text" class="form-control" [(ngModel)]="productoEditando.ubicacion" name="ubicacion" placeholder="Ej: Estante A3">
            </div>
            <div class="col-12">
              <label class="form-label">Descripci√≥n</label>
              <textarea class="form-control" [(ngModel)]="productoEditando.descripcion" name="descripcion" rows="3"></textarea>
            </div>
            <div class="col-md-2">
              <label class="form-label">Stock Actual</label>
              <input type="number" class="form-control" [(ngModel)]="productoEditando.cantidad" name="cantidad" min="0">
            </div>
            <div class="col-md-2">
              <label class="form-label">Stock M√≠nimo</label>
              <input type="number" class="form-control" [(ngModel)]="productoEditando.stockMinimo" name="stockMinimo" min="0">
            </div>
            <div class="col-md-3">
              <label class="form-label">Precio Costo (‚Ç≤)</label>
              <input type="number" class="form-control" [(ngModel)]="productoEditando.precioCosto" name="precioCosto" min="0" (ngModelChange)="calcularPrecioVentaEdicion()">
            </div>
            <div class="col-md-3">
              <label class="form-label">Precio Venta (‚Ç≤) <small class="text-muted">(+30% autom√°tico)</small></label>
              <input type="number" class="form-control bg-light" [(ngModel)]="productoEditando.precioVenta" name="precioVenta" min="0" readonly>
            </div>
            <div class="col-md-2">
              <label class="form-label">Proveedor</label>
              <input type="text" class="form-control" [(ngModel)]="productoEditando.proveedor" name="proveedor">
            </div>
          </div>
        </form>
      </div>

      <!-- PIE DEL MODAL -->
      <div class="modal-footer bg-light">
        <button type="button" class="btn btn-secondary" (click)="cerrarModalEdicion()" [disabled]="guardandoEdicion">
          <i class="fas fa-times me-2"></i>Cancelar
        </button>
        <button type="button" class="btn btn-warning" (click)="guardarEdicionCompleta()" [disabled]="guardandoEdicion">
          <span *ngIf="!guardandoEdicion"><i class="fas fa-save me-2"></i>Guardar Cambios</span>
          <span *ngIf="guardandoEdicion"><i class="fas fa-spinner fa-spin me-2"></i>Guardando...</span>
        </button>
      </div>
      
    </div>
  </div>
</div>
